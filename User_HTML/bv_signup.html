<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BondVoyage │ Sign Up</title>
    <link rel="stylesheet" href="../CSS/bv_signup.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="icon" href="../Images/favicon-32x32.png" type="image/png">
    <script src="https://www.google.com/recaptcha/api.js" async defer></script>
</head>
<body>
    <div class="signup-form-container">
        <form class="signup-form" action="../PHP/bv_signup_process.php" method="POST">
            <div id="initial-questions">
                
                <div class="form-header">
                    <div class="logo-container">
                        <img src="../Images/bv_logo.png" alt="Logo" class="logo">
                    </div>
                    <div class="title-container">
                        <img src="../Images/signup_title.png" alt="Create an Account" class="title-image">
                    </div>
                </div>
    
                <div class="form-group row">
                    <input type="text" name="first_name" placeholder="First Name" class="input-field half-width" required>
                    <input type="text" name="last_name" placeholder="Last Name" class="input-field half-width" required>
                </div>
                <div class="form-group email-group">
                    <input type="email" name="email" id="email" placeholder="Email" class="input-field full-width" required>
                    <i class="fas fa-envelope email-icon"></i>
                </div>                
                <div class="form-group row">
                    <input type="text" name="mobile" placeholder="Mobile Number" class="input-field half-width" required>
                    <input type="date" name="birthday" placeholder="Birthday" class="input-field half-width" required>
                </div>
                <div class="form-group row">
                    <div class="password-container">
                        <input type="password" name="password" id="password" placeholder="Password" class="input-field half-width" required>
                        <i class="fas fa-eye" id="togglePassword" style="cursor: pointer;"></i>
                    </div>
                    <div class="password-container">
                        <input type="password" name="password_confirmation" placeholder="Confirm Password" id="password_confirmation" class="input-field half-width" required>
                        <i class="fas fa-eye" id="togglePasswordConfirmation" style="cursor: pointer;"></i>
                    </div>                   
                </div>
                <div id="password-requirements" class="password-requirements" style="display: none;">
                    <p>Password must contain:</p>
                    <ul class="requirement-list">
                        <li>
                            <i class="fa-solid fa-circle"></i>
                            <span>At least 8 characters length</span>
                        </li>
                        <li>
                            <i class="fa-solid fa-circle"></i>
                            <span>At least 1 number (0-9)</span>
                        </li>
                        <li>
                            <i class="fa-solid fa-circle"></i>
                            <span>At least 1 lowercase letter (a-z)</span>
                        </li>
                        <li>
                            <i class="fa-solid fa-circle"></i>
                            <span>At least 1 special symbol (!, $, etc.)</span>
                        </li>
                        <li>
                            <i class="fa-solid fa-circle"></i>
                            <span>At least 1 uppercase letter (A-Z)</span>
                        </li>
                    </ul>
                </div>
                <div id="password-error" style="color: red; display: none; font-size: 15px; text-align: center; margin: 0 auto; margin-bottom: -10px;">
                    <p>Passwords do not match</p>
                </div>                
                <div class="form-group">
                    <button type="button" class="next-button" onclick="showSecurityQuestions()">Next</button>
                </div>
                <p class="login-text">Already have an account? <a href="../User_HTML/bv_login.html">Log In</a></p>
            </div>
    
            <!-- Security Questions Section (Initially Hidden) -->
            <div id="security-questions" style="display: none;">
                <div class="form-wrapper">
                    
                    <div class="left-section">
                        <button type="button" class="back-button" onclick="goBackToInitial()">Back</button>
                        <h1>Security Questions</h1>
                        <p>To help secure your account, we ask you to select and answer three security questions. These questions will assist you in recovering your account if you forget your password in the future.</p>
                    </div>
                    
                    <div class="right-section">
                        <!-- Security Question 1 -->
                        <div class="form-group security-question-container">
                            <label for="security_question_1" class="security-label">Security Question 1</label>
                            <select name="security_question_1" id="security_question_1" class="input-field" required onchange="toggleSecurityQuestionInput(1)">
                                <option value="" disabled selected>Select Security Question 1</option>
                                <option value="movie">What was the first movie you watched in theater?</option>
                                <option value="friend">What year did you meet your oldest friend?</option>
                                <option value="purchase">What is the first thing you bought with your own money?</option>
                                <option value="toy">What is the name of your favorite childhood toy?</option>
                                <option value="pet">What is the name of your first pet that wasn’t a dog or cat?</option>
                                <option value="book">What was the title of the first book you ever read by yourself?</option>
                                <option value="character">What is the name of the first fictional character you admired?</option>
                            </select>
                        </div>
                        <div class="form-group" id="security_answer_1_container">
                            <input type="text" name="security_answer_1" placeholder="Answer" id="security_answer_1" class="input-field" style="display: none;" required>
                        </div>
                        <!-- Security Question 2 -->
                        <div class="form-group security-question-container">
                            <label for="security_question_2" class="security-label">Security Question 2</label>
                            <select name="security_question_2" id="security_question_2" class="input-field" required onchange="toggleSecurityQuestionInput(2)">
                                <option value="" disabled selected>Select Security Question 2</option>
                                <option value="movie">What was the first movie you watched in theater?</option>
                                <option value="friend">What year did you meet your oldest friend?</option>
                                <option value="purchase">What is the first thing you bought with your own money?</option>
                                <option value="toy">What is the name of your favorite childhood toy?</option>
                                <option value="pet">What is the name of your first pet that wasn’t a dog or cat?</option>
                                <option value="book">What was the title of the first book you ever read by yourself?</option>
                                <option value="character">What is the name of the first fictional character you admired?</option>
                            </select>
                        </div>
                        <div class="form-group" id="security_answer_2_container">
                            <input type="text" name="security_answer_2" placeholder="Answer" id="security_answer_2" class="input-field" style="display: none;" required>
                        </div>
                        <!-- Security Question 3 -->
                        <div class="form-group security-question-container">
                            <label for="security_question_3" class="security-label">Security Question 3</label>
                            <select name="security_question_3" id="security_question_3" class="input-field" required onchange="toggleSecurityQuestionInput(3)">
                                <option value="" disabled selected>Select Security Question 3</option>
                                <option value="movie">What was the first movie you watched in theater?</option>
                                <option value="friend">What year did you meet your oldest friend?</option>
                                <option value="purchase">What is the first thing you bought with your own money?</option>
                                <option value="toy">What is the name of your favorite childhood toy?</option>
                                <option value="pet">What is the name of your first pet that wasn’t a dog or cat?</option>
                                <option value="book">What was the title of the first book you ever read by yourself?</option>
                                <option value="character">What is the name of the first fictional character you admired?</option>
                            </select>
                        </div>
                        <div class="form-group" id="security_answer_3_container">
                            <input type="text" name="security_answer_3" placeholder="Answer" id="security_answer_3" class="input-field" style="display: none;" required>
                        </div>
                        <div class="form-group recaptcha-container">
                            <div class="g-recaptcha" data-sitekey="6LdzmHcqAAAAACfqAFQK4QyibPiL2IOkMflLFbVT"></div>
                        </div>
                        <div class="form-group">
                            <button type="submit" class="signup-button">Sign Up</button>
                        </div>
                        <p class="login-text">Already have an account? <a href="../User_HTML/bv_login.html">Log In</a></p>
                    </div>
                </div>
            </div>
        </form>
    </div>

    <script>
        // Toggle Password Visibility
        document.getElementById('togglePassword').addEventListener('click', function () {
            const passwordInput = document.querySelector('input[name="password"]');
            const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
            passwordInput.setAttribute('type', type);
            this.classList.toggle('fa-eye-slash');
        });

        document.getElementById('togglePasswordConfirmation').addEventListener('click', function () {
            const passwordConfirmationInput = document.querySelector('input[name="password_confirmation"]');
            const type = passwordConfirmationInput.getAttribute('type') === 'password' ? 'text' : 'password';
            passwordConfirmationInput.setAttribute('type', type);
            this.classList.toggle('fa-eye-slash');
        });

        // Password Validation
        const passwordInput = document.getElementById("password");
        const passwordConfirmationInput = document.getElementById("password_confirmation");
        const requirementList = document.querySelectorAll(".requirement-list li");

        // Password requirements validation
        const requirements = [
            { regex: /.{8,}/, index: 0 }, // At least 8 characters
            { regex: /[0-9]/, index: 1 }, // At least one number
            { regex: /[a-z]/, index: 2 }, // At least one lowercase letter
            { regex: /[^A-Za-z0-9]/, index: 3 }, // At least one special character
            { regex: /[A-Z]/, index: 4 } // At least one uppercase letter
        ];

        // Show password requirements when password input is focused
        passwordInput.addEventListener("focus", function () {
            document.getElementById("password-requirements").style.display = 'block';
        });

        // Hide password requirements when focus is lost
        passwordInput.addEventListener("blur", function () {
            document.getElementById("password-requirements").style.display = 'none';
        });

        passwordInput.addEventListener("keyup", function () {
            requirements.forEach(item => {
                const isValid = item.regex.test(passwordInput.value);
                const requirementItem = requirementList[item.index];
                if (isValid) {
                    requirementItem.classList.add("valid");
                    requirementItem.firstElementChild.className = "fa-solid fa-check";
                } else {
                    requirementItem.classList.remove("valid");
                    requirementItem.firstElementChild.className = "fa-solid fa-circle";
                }
            });
        });

        // Show Password Requirements when clicking "Next"
        function showSecurityQuestions() {
            const password = document.querySelector('input[name="password"]').value;
            const passwordConfirmation = document.querySelector('input[name="password_confirmation"]').value;
            const passwordError = document.getElementById('password-error');
            
            // Check if passwords match
            if (password !== passwordConfirmation) {
                passwordError.style.display = 'block'; // Show error message if passwords don't match
                return; // Prevent transition to next section if passwords don't match
            }

            passwordError.style.display = 'none'; // Hide error message if passwords match

            // Check if the password meets all the criteria
            const isPasswordValid = requirements.every(item => item.regex.test(password));

            // Display the password requirements if password is invalid
            if (!isPasswordValid) {
                document.getElementById('password-requirements').style.display = 'block'; // Show requirement list if invalid
            } else {
                document.getElementById('password-requirements').style.display = 'none'; // Hide requirement list if valid
            }

            // Prevent moving to next section if password is invalid
            if (!isPasswordValid) {
                return; // Don't proceed to the next section if password is invalid
            }

            // Move to the next section if everything is valid
            document.getElementById('initial-questions').style.display = 'none';
            document.getElementById('security-questions').style.display = 'block';
            document.querySelector('.signup-form-container').classList.add('widened'); // Increase width
        }

        // Check password validity when the user types in the confirmation password field
        passwordConfirmationInput.addEventListener("keyup", checkPasswordValidity);

        // Check password validity for confirmation field
        function checkPasswordValidity() {
            const password = passwordInput.value;
            const passwordConfirmation = passwordConfirmationInput.value;
            const passwordError = document.getElementById('password-error');
            
            if (password !== passwordConfirmation) {
                passwordError.style.display = 'block';
            } else {
                passwordError.style.display = 'none';
            }
        }

        const emailInput = document.getElementById('email');
        const emailIcon = document.querySelector('.email-icon');

        emailInput.addEventListener('input', function () {
            const emailValue = emailInput.value;
            const regex = /^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;  // Email validation regex

            if (regex.test(emailValue)) {
                emailIcon.classList.remove('fa-envelope');    // Remove default envelope icon
                emailIcon.classList.add('fa-check-circle');  // Add check-circle icon
                emailIcon.style.color = '#585D27';            // Change icon color to green (valid)
            } else {
                emailIcon.classList.remove('fa-check-circle'); // Remove check-circle icon
                emailIcon.classList.add('fa-envelope');        // Add default envelope icon
                emailIcon.style.color = 'red';                  // Change icon color to red (invalid)
            }
        });
        
        // Go Back to Initial Questions
        function goBackToInitial() {
            document.getElementById('initial-questions').style.display = 'block';
            document.getElementById('security-questions').style.display = 'none';
            document.querySelector('.signup-form-container').classList.remove('widened'); // Revert width
        }

        // Toggle the visibility of the input field for security question answers
        function toggleSecurityQuestionInput(questionNumber) {
            const selectElement = document.getElementById(`security_question_${questionNumber}`);
            const answerContainer = document.getElementById(`security_answer_${questionNumber}_container`);
            const answerInput = document.getElementById(`security_answer_${questionNumber}`);

            // Always display the answer input when a question is selected
            if (selectElement.value) {
                answerContainer.style.display = 'block';
                answerInput.style.display = 'block';
            } else {
                answerContainer.style.display = 'none';
                answerInput.style.display = 'none';
            }
        }
    </script>
</body>
</html>